@using NETCoreExperimentalWebApp.Models.StarWarsModels
@using Newtonsoft.Json
@model IEnumerable<StarshipModel>

@{
    ViewData["Title"] = "Starships";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2 class="ui header">Starships</h2>
<div class="ui input">
    <input type="text" class="remove starship input"/>
</div>
<div class="ui remove button">Remove Starship</div>
<div class="ui divider"></div>

<div data-bind="foreach: starships" id="gridItems" class="ui link cards column">
    <div class="ui card">
        <div class="content">
            <div class="header" data-bind="text: Name"></div>
        </div>
        <div class="content">
            <div class="meta" data-bind="text: Model"></div>
            <div class="meta" data-bind="text: Manufacturer"></div>
            <div class="meta" data-bind="text: Cost_In_Credits() + ' credits'"></div>
        </div>
        <div class="content">
            <div class="description" data-bind="text: Length() + ' meters'"></div>
            <div class="description" data-bind="text: 'Hyperdrive Rating: ' + Hyperdrive_Rating()"></div>
            <div class="description" data-bind="text: 'MGLT: ' + MGLT()"></div>
        </div>
    </div>
</div>

@section Scripts {
    <script type="text/javascript" src='@Url.Content("~/js/KOModels/StarshipViewModel.js")'></script>
    <script>
        viewModel = {
            starships: ko.observableArray()
        };

        $(document).ready(function() {
            // Initialize dropdowns
            $('.ui.dropdown').dropdown();

            // Convert MVC Model to Knockout ViewModel
            ko.mapping.fromJS(@Html.Raw(JsonConvert.SerializeObject(Model)), {}, viewModel.starships);
            ko.applyBindings(viewModel);
        });

        function removeStarshipByName(name) {
            viewModel.starships.remove(function(starship) {
                return starship.Name().toString() === name;
            });
        };

        $(".remove").on("click",
            function () {
                removeStarshipByName($('.remove.input').val());
                $('.remove.input').val('');
            });

    </script>
}